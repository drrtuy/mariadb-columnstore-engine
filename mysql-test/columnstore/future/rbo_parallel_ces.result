CREATE USER IF NOT EXISTS'cejuser'@'localhost' IDENTIFIED BY 'Vagrant1|0000001';
GRANT ALL PRIVILEGES ON *.* TO 'cejuser'@'localhost';
FLUSH PRIVILEGES;
CREATE USER IF NOT EXISTS'cejuser'@'localhost' IDENTIFIED BY 'Vagrant1|0000001';
GRANT ALL PRIVILEGES ON *.* TO 'cejuser'@'localhost';
FLUSH PRIVILEGES;
DROP DATABASE IF EXISTS rbo_parallel_ces;
CREATE DATABASE rbo_parallel_ces;
USE rbo_parallel_ces;
SELECT calsettrace(1);
calsettrace(1)
0
CREATE TABLE Ti (col1 INT, col2 INT, col3 INT) ENGINE=InnoDB;
INSERT INTO Ti (col1, col2, col3)
SELECT seq, seq+1, seq+2 FROM (SELECT seq FROM seq_1_to_100) AS numbers;
SET @@histogram_size=10;
ANALYZE TABLE Ti PERSISTENT FOR ALL;
Table	Op	Msg_type	Msg_text
rbo_parallel_ces.Ti	analyze	status	Engine-independent statistics collected
rbo_parallel_ces.Ti	analyze	status	OK
CREATE INDEX excellent_index ON Ti(col1);
SET @@columnstore_unstable_optimizer=ON;
SET @@optimizer_switch='derived_merge=off';
SET @@columnstore_ces_optimization_parallel_factor=5;
SELECT SUM(col1) FROM Ti;
SUM(col1)
5050
SET @orig_plan := mcsgetplan('original');
SET @opt_plan := mcsgetplan('optimized');
SET @rbo_rules := mcsgetplan('rules');
SET @uu_tail := SUBSTRING_INDEX(@orig_plan, '--- Union Unit ---', -1);
SET @unit_open := CONCAT(CHAR(10),'    {',CHAR(10));
SELECT (CHAR_LENGTH(@uu_tail) - CHAR_LENGTH(REPLACE(@uu_tail, @unit_open, '')))/CHAR_LENGTH(@unit_open) AS unions_original;
unions_original
0.0000
SET @uu_tail := SUBSTRING_INDEX(@opt_plan, '--- Union Unit ---', -1);
SELECT (CHAR_LENGTH(@uu_tail) - CHAR_LENGTH(REPLACE(@uu_tail, @unit_open, '')))/CHAR_LENGTH(@unit_open) AS unions_optimized_5;
unions_optimized_5
5.0000
SELECT @rbo_rules LIKE '%parallel_ces%' AS rule_parallel_ces_applied;
rule_parallel_ces_applied
1
SET @@columnstore_ces_optimization_parallel_factor=15;
SELECT SUM(col1) FROM Ti;
SUM(col1)
5050
SET @opt_plan := mcsgetplan('optimized');
SET @uu_tail := SUBSTRING_INDEX(@opt_plan, '--- Union Unit ---', -1);
SELECT (CHAR_LENGTH(@uu_tail) - CHAR_LENGTH(REPLACE(@uu_tail, @unit_open, '')))/CHAR_LENGTH(@unit_open) AS unions_optimized_15;
unions_optimized_15
10.0000
SELECT calsettrace(0);
calsettrace(0)
1
DROP DATABASE rbo_parallel_ces;
REVOKE ALL PRIVILEGES ON *.* FROM 'cejuser'@'localhost';
DROP USER 'cejuser'@'localhost';
